---
title: 'Project 1'
author: "Grace Chang, Seungwan Kim, Riley C Maher, Sage O'Toole, Jenna Kay Probst"
date: "2/21/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Hotel Bookings Data Import

I will import the hotel bookings data in this section and remove columns that I will not be using for analysis, as well as change some column values to factors.

```{r}

hotel_bookings <- read.csv('hotel_bookings.csv')
head(hotel_bookings)
str(hotel_bookings)

# FACTORS - hotel, arrival_date_month, meal, market_segment, reserved_room_type, assigned_room_type, customer_type, deposit_type, reservation_status

unique(hotel_bookings$reservation_status)

hotel_bookings$hotel <- as.factor(hotel_bookings$hotel)
hotel_bookings$arrival_date_month <- as.factor(hotel_bookings$arrival_date_month)
hotel_bookings$meal <- as.factor(hotel_bookings$meal)
hotel_bookings$market_segment <- as.factor(hotel_bookings$market_segment)
hotel_bookings$distribution_channel <- as.factor(hotel_bookings$distribution_channel)
hotel_bookings$reserved_room_type <- as.factor(hotel_bookings$reserved_room_type)
hotel_bookings$assigned_room_type <- as.factor(hotel_bookings$assigned_room_type)
hotel_bookings$customer_type <- as.factor(hotel_bookings$customer_type)
hotel_bookings$deposit_type <- as.factor(hotel_bookings$deposit_type)
hotel_bookings$reservation_status <- as.factor(hotel_bookings$reservation_status)

```

## Preliminary Assumptions about Hotel Bookings
1. Higher lead times will increase chances of cancellation
2. There will be more people arriving at the hotels during the summer months.
3. Non-refundable bookings will have lower chance of cancellation

## General observation of data

### Proportion of cancellations
```{r}
nrow(hotel_bookings)

summary(hotel_bookings$is_canceled)
table(hotel_bookings$is_canceled)

# The function prop.table will convert the table to proportions.
prop.table(table(hotel_bookings$is_canceled))

# We can round the proportion table to 3 decimal points. 
round(prop.table(table(hotel_bookings$is_canceled)), digits = 3)
```
*Around 37% of hotel bookings were canceled*

### Cancellation based on Months
```{r}

month_cancel <- round(prop.table(table(hotel_bookings$arrival_date_month, hotel_bookings$is_canceled),1), digits = 3)
month_cancel

sorted_month_cancel <- month_cancel[order(month_cancel[,1]),]
sorted_month_cancel
```
*Highest proportion of cancellations were in June*

### Cancellation by Hotel Type
```{r}

hotel_type_cancel <- round(prop.table(table(hotel_bookings$hotel, hotel_bookings$is_canceled),1),digits=3)
hotel_type_cancel

```
*City hotel has 41.73% rate of cancellation, resort hotel has 27.76%*

### Cancellation by Country of Origin
```{r}
country_cancel <- round(prop.table(table(hotel_bookings$country, hotel_bookings$is_canceled),1),digits=3)
sorted_country_cancel <- country_cancel[order(country_cancel[,1]),]
head(sorted_country_cancel,20)
```


## Assumption 1 - Higher lead times will increase chances of cancellation

```{r}
hotel_bookings$lead_time_week <- hotel_bookings$lead_time / 7
hist(hotel_bookings$lead_time_week,  main="Lead Times", xlab="Weeks")
hotel_bookings$lead_time_bins <- as.numeric(cut2(hotel_bookings$lead_time_week, g=3))
                                            
```


## Assumption 2 - There will be more bookings arriving at the hotels during the summer months

```{r}
hotel_bookings$season <- ifelse(hotel_bookings$arrival_date_month == "December"|
                                hotel_bookings$arrival_date_month == "January"|
                                hotel_bookings$arrival_date_month == "February",
                                "Winter",
                          ifelse(hotel_bookings$arrival_date_month == "March"|
                                 hotel_bookings$arrival_date_month == "April"|
                                 hotel_bookings$arrival_date_month == "May",
                                "Spring",
                          ifelse(hotel_bookings$arrival_date_month == "June"|
                                 hotel_bookings$arrival_date_month == "July"|
                                 hotel_bookings$arrival_date_month == "August",
                                "Summer",
                                "Autumn")))
library("dplyr")
sample_n(hotel_bookings, 10)
seasons <- table(hotel_bookings$season)
round(prop.table(seasons),digits=3)
```


## Assumption 3 - Non-refundable bookings will have lower chance of cancellation

### Cancellation by Deposit Type
```{r}
deposit_cancel <- round(prop.table(table(hotel_bookings$deposit_type, hotel_bookings$is_canceled),1),digits=3)
deposit_cancel
#weird here - https://www.kaggle.com/jessemostipak/hotel-booking-demand/discussion/131787

#From Kaggle
#No Deposit – no deposit was made; 
#Non Refund – a deposit was made in the value of the total stay cost; 
#Refundable – a deposit was made with a value under the total cost of stay.
```
*We found that it was very odd that 99.4% of non-refundable bookings were canceled*

